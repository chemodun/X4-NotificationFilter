<?xml version="1.0" encoding="utf-8"?>
<mdscript name="Notification_Filter_Options_Menu" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <cues>
    <cue name="Init" instantiate="false" version="1">
      <actions>
      </actions>
      <cues>
        <cue name="Register_Menu" instantiate="true" version="1">
          <conditions>
            <event_cue_signalled cue="md.Simple_Menu_API.Reloaded" />
          </conditions>
          <actions>
            <debug_text text="'NotificationFilter Options: Registering Options Menus'" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <include_actions ref="md.Notification_Filter.DefaultFilters" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Register_Options_Menu"
              param="table[
                $id      = 'Notification_Filter_options_menu',
                $columns = 8,
                $title   = {1972092413, 10000},
                $onOpen  = Notification_Filter_Options_Menu,
              ]" />
          </actions>
        </cue>

        <cue name="Notification_Filter_Options_Menu" instantiate="true" version="1">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <debug_text text="'NotificationFilter Options: Opening Notification Filter Menu'" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <include_actions ref="md.Notification_Filter.DefaultFilters" />
            <debug_text
              text="'NotificationFilter Options: Current filters: %s' . [$filters]"
              chance="@$notificationFiltersDebugChance" filter="scripts" />
            <include_actions ref="Menu_Section_Reputation" />
            <include_actions ref="Menu_Section_Money" />
            <include_actions ref="Menu_Section_CraftingProgress" />
            <include_actions ref="Menu_Section_InsufficientFunds" />
            <include_actions ref="Menu_Section_Other" />
            <remove_value name="$filters" />
          </actions>
        </cue>

        <library name="Menu_Section_Reputation" purpose="include_actions">
          <actions>
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 8,
                $titleColor = 'Color.text_normal',
                $halign = 'center',
                $text = {1972092413, 10100},
              ]" />
            <set_value name="$reputation" exact="$filters.$reputation" />
            <include_actions ref="GetCurrentReputationOptionsAndIndex" />
            <debug_text text="'NotificationFilter Options: Reputation filter value: %s, index: %s' . [$reputation, $reputationIndex]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 5,
                $text = {1972092413, 10110},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Dropdown"
              param="table[
                $id = 'Notification_Filter_Reputation',
                $col = 6,
                $colSpan = 3,
                $options = $reputationOptions,
                $startOption = $reputationIndex,
                $onDropDownConfirmed = Handle_Dropdown_Changed,
              ]" />
            <set_value name="$reputation" exact="$filters.$reputationLogbook" />
            <include_actions ref="GetCurrentReputationOptionsAndIndex" />
            <debug_text text="'NotificationFilter Options: Reputation Logbook filter value: %s, index: %s' . [$reputation, $reputationIndex]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 5,
                $text = {1972092413, 10120},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Dropdown"
              param="table[
                $id = 'Notification_Filter_Reputation_Logbook',
                $col = 6,
                $colSpan = 3,
                $options = $reputationOptions,
                $startOption = $reputationIndex,
                $onDropDownConfirmed = Handle_Dropdown_Changed,
              ]" />
          </actions>
        </library>

        <library name="Menu_Section_Money" purpose="include_actions">
          <actions>
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 8,
                $titleColor = 'Color.text_normal',
                $halign = 'center',
                $text = {1972092413, 10200},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 8,
                $halign = 'left',
                $text = {1972092413, 10210},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Slider"
              param="table[
                $id = 'Notification_Filter_Money',
                $col = 1,
                $colSpan = 8,
                $min = 0,
                $max = 100000000,
                $step = 1000,
                $start = $filters.$money,
                $suffix = ' %s.'.[{1001, 101}],
                $onSliderCellConfirm = Handle_Slider_Changed,
              ]" />
          </actions>
        </library>

        <library name="Menu_Section_CraftingProgress" purpose="include_actions">
          <actions>
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 8,
                $titleColor = 'Color.text_normal',
                $halign = 'center',
                $text = {1972092413, 10300},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_CheckBox"
              param="table[
                $id = 'Notification_Filter_CraftingProgress',
                $checked = @$filters.$craftingProgress == true,
                $col = 1,
                $width = 'Helper.standardButtonHeight',
                $height = 'Helper.standardButtonHeight',
                $onClick = Handle_Checkbox_Changed
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 2,
                $colSpan = 7,
                $halign = 'left',
                $text = {1972092413, 10310},
              ]" />
          </actions>
        </library>

        <library name="Menu_Section_InsufficientFunds" purpose="include_actions">
          <actions>
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 8,
                $titleColor = 'Color.text_normal',
                $halign = 'center',
                $text = {1972092413, 10400},
              ]" />

            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_CheckBox"
              param="table[
                $id = 'Notification_Filter_InsufficientFunds',
                $checked = @$filters.$insufficientFunds == true,
                $col = 1,
                $width = 'Helper.standardButtonHeight',
                $height = 'Helper.standardButtonHeight',
                $onClick = Handle_Checkbox_Changed
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 2,
                $colSpan = 7,
                $halign = 'left',
                $text = {1972092413, 10410},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_CheckBox"
              param="table[
                $id = 'Notification_Filter_InsufficientFunds_Logbook',
                $checked = @$filters.$insufficientFundsLogbook == true,
                $col = 1,
                $width = 'Helper.standardButtonHeight',
                $height = 'Helper.standardButtonHeight',
                $onClick = Handle_Checkbox_Changed
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 2,
                $colSpan = 7,
                $halign = 'left',
                $text = {1972092413, 10420},
              ]" />
          </actions>
        </library>


        <library name="Menu_Section_Other" purpose="include_actions">
          <actions>
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 1,
                $colSpan = 8,
                $titleColor = 'Color.text_normal',
                $halign = 'center',
                $text = {1972092413, 19900},
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Add_Row" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_CheckBox"
              param="table[
                $id = 'Notification_Filter_Debug',
                $checked = @$filters.$debugChance gt 0,
                $col = 1,
                $width = 'Helper.standardButtonHeight',
                $height = 'Helper.standardButtonHeight',
                $onClick = Handle_Checkbox_Changed
              ]" />
            <signal_cue_instantly cue="md.Simple_Menu_API.Make_Text"
              param="table[
                $col = 2,
                $colSpan = 7,
                $halign = 'left',
                $text = {1972092413, 19910},
              ]" />
          </actions>
        </library>

        <cue name="Handle_Dropdown_Changed" instantiate="true" version="1">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <include_actions ref="md.Notification_Filter.DefaultFilters" />
            <debug_text text="'NotificationFilter Options: Dropdown %s changed to %s. Current filters: %s' .[event.param.$id, event.param.$option.$value, $filters]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <set_value name="$id" exact="event.param.$id" />
            <set_value name="$value" exact="event.param.$option.$value" />
            <do_if value="$id == 'Notification_Filter_Reputation'">
              <set_value name="$filters.$reputation" exact="$value" />
            </do_if>
            <do_elseif value="$id == 'Notification_Filter_Reputation_Logbook'">
              <set_value name="$filters.$reputationLogbook" exact="$value" />
            </do_elseif>
            <debug_text text="'NotificationFilter Options: Updated filters: %s' . [$filters]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <remove_value name="$id" />
            <remove_value name="$value" />
            <remove_value name="$filters" />
          </actions>
        </cue>

        <cue name="Handle_Slider_Changed" instantiate="true" version="1">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <include_actions ref="md.Notification_Filter.DefaultFilters" />
            <debug_text text="'NotificationFilter Options: Slider %s changed to %s. Current filters: %s' .[event.param.$id, event.param.$value, $filters]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <set_value name="$id" exact="event.param.$id" />
            <set_value name="$value" exact="event.param.$value" />
            <do_if value="$id == 'Notification_Filter_Money'">
              <set_value name="$filters.$money" exact="$value" />
            </do_if>
            <debug_text text="'NotificationFilter Options: Updated filters: %s' . [$filters]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <remove_value name="$id" />
            <remove_value name="$value" />
            <remove_value name="$filters" />
          </actions>
        </cue>

        <cue name="Handle_Checkbox_Changed" instantiate="true" version="1">
          <conditions>
            <event_cue_signalled />
          </conditions>
          <actions>
            <include_actions ref="md.Notification_Filter.DefaultFilters" />
            <debug_text text="'NotificationFilter Options: Checkbox %s changed to %s. Current filters: %s' .[event.param.$id, event.param.$checked, $filters]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <set_value name="$id" exact="event.param.$id" />
            <set_value name="$value" exact="if @event.param.$checked then 100 else 0" />
            <do_if value="$id == 'Notification_Filter_Debug'">
              <set_value name="$filters.$debugChance" exact="$value" />
              <set_value name="$notificationFiltersDebugChance" exact="$value" />
            </do_if>
            <do_if value="$id == 'Notification_Filter_CraftingProgress'">
              <set_value name="$filters.$craftingProgress" exact="event.param.$checked" />
            </do_if>
            <do_if value="$id == 'Notification_Filter_InsufficientFunds'">
              <set_value name="$filters.$insufficientFunds" exact="event.param.$checked" />
            </do_if>
            <do_if value="$id == 'Notification_Filter_InsufficientFunds_Logbook'">
              <set_value name="$filters.$insufficientFundsLogbook" exact="event.param.$checked" />
            </do_if>
            <debug_text text="'NotificationFilter Options: Updated filters: %s' . [$filters]" chance="@$notificationFiltersDebugChance" filter="scripts" />
            <remove_value name="$id" />
            <remove_value name="$value" />
            <remove_value name="$filters" />
          </actions>
        </cue>

        <library name="GetCurrentReputationOptionsAndIndex" purpose="include_actions">
          <actions>
            <set_value name="$reputationOptions" exact="[
              table[ $text = {1972092413, 10111}, $value = 0 ],
              table[ $text = {1972092413, 10112}, $value = 1 ],
              table[ $text = {1972092413, 10113}, $value = 2 ],
              table[ $text = {1972092413, 10114}, $value = 5 ],
              table[ $text = {1972092413, 10115}, $value = 10 ]
            ]" />
            <set_value name="$reputationIndex" exact="1" />
            <do_if value="$reputation == 0">
              <set_value name="$reputationIndex" exact="1" />
            </do_if>
            <do_elseif value="$reputation == 1">
              <set_value name="$reputationIndex" exact="2" />
            </do_elseif>
            <do_elseif value="$reputation == 2">
              <set_value name="$reputationIndex" exact="3" />
            </do_elseif>
            <do_elseif value="$reputation == 5">
              <set_value name="$reputationIndex" exact="4" />
            </do_elseif>
            <do_elseif value="$reputation == 10">
              <set_value name="$reputationIndex" exact="5" />
            </do_elseif>
          </actions>
        </library>

      </cues>
    </cue>


  </cues>
</mdscript>