<mdscript name="Notification_Filter" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <cues>

    <cue name="Main" version="1">
      <actions>
        <debug_text text="'NotificationFilter: Main'" chance="100" filter="scripts" />
        <include_actions ref="DefaultFilters" />
        <remove_value name="$filters" />
      </actions>
    </cue>


    <library name="DefaultFilters" purpose="include_actions">
      <actions>
        <do_if value="@player.entity.$notificationFilters == null">
          <set_value name="player.entity.$notificationFilters" exact="table[$reputation = 1, $reputationLogbook = 1, $money = 1000]" />
        </do_if>
        <set_value name="$filters" exact="@player.entity.$notificationFilters" />
      </actions>
    </library>

    <library name="Filter_BaseRelationChanged_Notification_up" purpose="include_actions">
      <actions>
        <include_actions ref="DefaultFilters" />
        <set_value name="$relationFilter" exact="$filters.$reputation" />
        <do_if value="abs($oldnum - $newnum) gt $relationFilter ">
          <show_notification text="$tickertext" sound="ui_mon_eve_notoriety_up" />
        </do_if>
        <remove_value name="$filters" />
        <remove_value name="$relationFilter" />
      </actions>
    </library>

    <library name="Filter_BaseRelationChanged_Notification_down" purpose="include_actions">
      <actions>
        <include_actions ref="DefaultFilters" />
        <set_value name="$relationFilter" exact="$filters.$reputation" />
        <do_if value="abs($oldnum - $newnum) gt $relationFilter">
          <show_notification text="$tickertext" sound="ui_mon_eve_notoriety_down" />
        </do_if>
        <remove_value name="$filters" />
        <remove_value name="$relationFilter" />
      </actions>
    </library>

    <library name="Filter_BaseRelationChanged_Logbook" purpose="include_actions">
      <actions>
        <include_actions ref="DefaultFilters" />
        <set_value name="$relationFilter" exact="$filters.$reputationLogbook" />
        <do_if value="abs($oldnum - $newnum) gt $relationFilter">
          <write_to_logbook category="general" title="$title" faction="event.param" text="$logtext" />
        </do_if>
        <remove_value name="$filters" />
        <remove_value name="$relationFilter" />
      </actions>
    </library>

    <library name="Filter_layerMoneyTransfer_Notification_up" purpose="include_actions">
      <actions>
        <include_actions ref="DefaultFilters" />
        <set_value name="$moneyFilter" exact="$filters.$money * 1Cr" />
        <debug_text text="'NotificationFilter: Money transfer: %s. Balance: %s. Filter: %s' . [event.param2 - event.param, event.param2, $moneyFilter]" chance="100" filter="scripts" />
        <do_if value="abs(event.param - event.param2) gt $moneyFilter ">
          <show_notification text="$message" sound="ui_mon_eve_money_up" />
        </do_if>
        <remove_value name="$filters" />
        <remove_value name="$moneyFilter" />
      </actions>
    </library>

    <library name="Filter_layerMoneyTransfer_Notification_down" purpose="include_actions">
      <actions>
        <include_actions ref="DefaultFilters" />
        <set_value name="$moneyFilter" exact="$filters.$money * 1Cr" />
        <debug_text text="'NotificationFilter: Money transfer: %s. Balance: %s. Filter: %s' . [event.param2 - event.param, event.param2, $moneyFilter]" chance="100" filter="scripts" />
        <do_if value="abs(event.param - event.param2) gt $moneyFilter ">
          <show_notification text="$message" sound="ui_mon_eve_money_down" />
        </do_if>
        <remove_value name="$filters" />
        <remove_value name="$moneyFilter" />
      </actions>
    </library>


  </cues>

</mdscript>